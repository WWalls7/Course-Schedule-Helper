{"ast":null,"code":"/**\r\n * DevExtreme (ui/scheduler/appointmentPopup.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _renderer = require(\"../../core/renderer\");\n\nvar _renderer2 = _interopRequireDefault(_renderer);\n\nvar _popup = require(\"../popup\");\n\nvar _popup2 = _interopRequireDefault(_popup);\n\nvar _window = require(\"../../core/utils/window\");\n\nvar _window2 = _interopRequireDefault(_window);\n\nvar _uiScheduler = require(\"./ui.scheduler.appointment_form\");\n\nvar _uiScheduler2 = _interopRequireDefault(_uiScheduler);\n\nvar _devices = require(\"../../core/devices\");\n\nvar _devices2 = _interopRequireDefault(_devices);\n\nvar _dom = require(\"../../core/utils/dom\");\n\nvar _dom2 = _interopRequireDefault(_dom);\n\nvar _object = require(\"../../core/utils/object\");\n\nvar _object2 = _interopRequireDefault(_object);\n\nvar _date = require(\"../../core/utils/date\");\n\nvar _date2 = _interopRequireDefault(_date);\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n\n    if (\"value\" in descriptor) {\n      descriptor.writable = true;\n    }\n\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) {\n    _defineProperties(Constructor.prototype, protoProps);\n  }\n\n  if (staticProps) {\n    _defineProperties(Constructor, staticProps);\n  }\n\n  return Constructor;\n}\n\nvar toMs = _date2.default.dateToMilliseconds;\nvar WIDGET_CLASS = \"dx-scheduler\";\nvar APPOINTMENT_POPUP_CLASS = \"\".concat(WIDGET_CLASS, \"-appointment-popup\");\nvar APPOINTMENT_POPUP_WIDTH = 610;\nvar APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH = 768;\nvar TOOLBAR_ITEM_AFTER_LOCATION = \"after\";\nvar TOOLBAR_ITEM_BEFORE_LOCATION = \"before\";\n\nvar AppointmentPopup = function () {\n  function AppointmentPopup(scheduler) {\n    _classCallCheck(this, AppointmentPopup);\n\n    this.scheduler = scheduler;\n    this._popup = null;\n    this._appointmentForm = null;\n    this.state = {\n      lastEditData: null,\n      appointment: {\n        data: null,\n        processTimeZone: false,\n        isEmptyText: false,\n        isEmptyDescription: false\n      }\n    };\n  }\n\n  _createClass(AppointmentPopup, [{\n    key: \"show\",\n    value: function (data, showButtons, processTimeZone) {\n      var _this = this;\n\n      this.state.appointment = {\n        data: data || {},\n        processTimeZone: processTimeZone\n      };\n\n      if (!this._popup) {\n        this._popup = this._createPopup();\n      }\n\n      this._popup.option({\n        toolbarItems: showButtons ? this._getPopupToolbarItems() : [],\n        showCloseButton: showButtons ? this._popup.initialOption(\"showCloseButton\") : true\n      });\n\n      this._popup.option(\"onShowing\", function (e) {\n        _this._updateForm(data, processTimeZone);\n\n        var arg = {\n          form: _this._appointmentForm,\n          appointmentData: data,\n          cancel: false\n        };\n\n        _this.scheduler._actions.onAppointmentFormOpening(arg);\n\n        _this.scheduler._processActionResult(arg, function (canceled) {\n          if (canceled) {\n            e.cancel = true;\n          } else {\n            _this.updatePopupFullScreenMode();\n          }\n        });\n      });\n\n      this._popup.show();\n    }\n  }, {\n    key: \"hide\",\n    value: function () {\n      this._popup.hide();\n    }\n  }, {\n    key: \"isVisible\",\n    value: function () {\n      return this._popup ? this._popup.option(\"visible\") : false;\n    }\n  }, {\n    key: \"getPopup\",\n    value: function () {\n      return this._popup;\n    }\n  }, {\n    key: \"dispose\",\n    value: function () {\n      if (this._$popup) {\n        this._popup.$element().remove();\n\n        this._$popup = null;\n      }\n    }\n  }, {\n    key: \"_createPopup\",\n    value: function () {\n      var popupElement = (0, _renderer2.default)(\"<div>\").addClass(APPOINTMENT_POPUP_CLASS).appendTo(this.scheduler.$element());\n      return this.scheduler._createComponent(popupElement, _popup2.default, this._createPopupConfig());\n    }\n  }, {\n    key: \"_createPopupConfig\",\n    value: function () {\n      var _this2 = this;\n\n      return {\n        height: \"auto\",\n        maxHeight: \"100%\",\n        onHiding: function () {\n          _this2._appointmentForm.resetValues();\n\n          _this2.scheduler.focus();\n        },\n        contentTemplate: function () {\n          return _this2._createPopupContent();\n        },\n        defaultOptionsRules: [{\n          device: function () {\n            return _devices2.default.current().android;\n          },\n          options: {\n            showTitle: false\n          }\n        }]\n      };\n    }\n  }, {\n    key: \"_createPopupContent\",\n    value: function () {\n      var formElement = (0, _renderer2.default)(\"<div>\");\n      this._appointmentForm = this._createForm(formElement);\n      return formElement;\n    }\n  }, {\n    key: \"_createAppointmentFormData\",\n    value: function (appointmentData) {\n      var result = (0, _extend.extend)(true, {}, appointmentData);\n      (0, _iterator.each)(this.scheduler._resourcesManager.getResourcesFromItem(result, true) || {}, function (name, value) {\n        return result[name] = value;\n      });\n      return result;\n    }\n  }, {\n    key: \"_createForm\",\n    value: function (element) {\n      var expr = this.scheduler._dataAccessors.expr;\n      var resources = this.scheduler.option(\"resources\");\n\n      _uiScheduler2.default.prepareAppointmentFormEditors({\n        textExpr: expr.textExpr,\n        allDayExpr: expr.allDayExpr,\n        startDateExpr: expr.startDateExpr,\n        endDateExpr: expr.endDateExpr,\n        descriptionExpr: expr.descriptionExpr,\n        recurrenceRuleExpr: expr.recurrenceRuleExpr,\n        startDateTimeZoneExpr: expr.startDateTimeZoneExpr,\n        endDateTimeZoneExpr: expr.endDateTimeZoneExpr\n      }, this.scheduler);\n\n      if (resources && resources.length) {\n        this.scheduler._resourcesManager.setResources(this.scheduler.option(\"resources\"));\n\n        _uiScheduler2.default.concatResources(this.scheduler._resourcesManager.getEditors());\n      }\n\n      return _uiScheduler2.default.create(this.scheduler._createComponent.bind(this.scheduler), element, this._isReadOnly(this.state.appointment.data), this._createAppointmentFormData(this.state.appointment.data));\n    }\n  }, {\n    key: \"_isReadOnly\",\n    value: function (data) {\n      if (data && data.disabled) {\n        return true;\n      }\n\n      return this.scheduler._editAppointmentData ? !this.scheduler._editing.allowUpdating : false;\n    }\n  }, {\n    key: \"_updateForm\",\n    value: function (appointmentData, isProcessTimeZone) {\n      var allDay = this.scheduler.fire(\"getField\", \"allDay\", appointmentData);\n      var startDate = this.scheduler.fire(\"getField\", \"startDate\", appointmentData);\n      var endDate = this.scheduler.fire(\"getField\", \"endDate\", appointmentData);\n\n      var formData = this._createAppointmentFormData(appointmentData);\n\n      this.state.appointment.isEmptyText = void 0 === appointmentData || void 0 === appointmentData.text;\n      this.state.appointment.isEmptyDescription = void 0 === appointmentData || void 0 === appointmentData.description;\n\n      if (this.state.appointment.isEmptyText) {\n        formData.text = \"\";\n      }\n\n      if (this.state.appointment.isEmptyDescription) {\n        formData.description = \"\";\n      }\n\n      if (isProcessTimeZone) {\n        startDate = this.scheduler.fire(\"convertDateByTimezone\", startDate);\n        endDate = this.scheduler.fire(\"convertDateByTimezone\", endDate);\n        this.scheduler.fire(\"setField\", \"startDate\", formData, startDate);\n        this.scheduler.fire(\"setField\", \"endDate\", formData, endDate);\n      }\n\n      var startDateExpr = this.scheduler._dataAccessors.expr.startDateExpr;\n      var endDateExpr = this.scheduler._dataAccessors.expr.endDateExpr;\n      formData.recurrenceRule = formData.recurrenceRule || \"\";\n\n      _uiScheduler2.default.updateFormData(this._appointmentForm, formData);\n\n      this._appointmentForm.option(\"readOnly\", this._isReadOnly(this.state.appointment.data));\n\n      _uiScheduler2.default.checkEditorsType(this._appointmentForm, startDateExpr, endDateExpr, allDay);\n\n      var recurrenceRuleExpr = this.scheduler._dataAccessors.expr.recurrenceRuleExpr;\n      var recurrentEditorItem = recurrenceRuleExpr ? this._appointmentForm.itemOption(recurrenceRuleExpr) : null;\n\n      if (recurrentEditorItem) {\n        var options = recurrentEditorItem.editorOptions || {};\n        options.startDate = startDate;\n\n        this._appointmentForm.itemOption(recurrenceRuleExpr, \"editorOptions\", options);\n      }\n    }\n  }, {\n    key: \"_isPopupFullScreenNeeded\",\n    value: function () {\n      if (_window2.default.hasWindow()) {\n        var window = _window2.default.getWindow();\n\n        return (0, _renderer2.default)(window).width() < APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH;\n      }\n\n      return false;\n    }\n  }, {\n    key: \"triggerResize\",\n    value: function () {\n      this._popup && _dom2.default.triggerResizeEvent(this._popup.$element());\n    }\n  }, {\n    key: \"updatePopupFullScreenMode\",\n    value: function () {\n      if (this.isVisible()) {\n        var isFullScreen = this._isPopupFullScreenNeeded();\n\n        this._popup.option({\n          maxWidth: isFullScreen ? \"100%\" : APPOINTMENT_POPUP_WIDTH,\n          fullScreen: isFullScreen\n        });\n      }\n    }\n  }, {\n    key: \"_getPopupToolbarItems\",\n    value: function () {\n      var _this3 = this;\n\n      var isIOs = \"ios\" === _devices2.default.current().platform;\n\n      return [{\n        shortcut: \"done\",\n        location: TOOLBAR_ITEM_AFTER_LOCATION,\n        onClick: function (e) {\n          return _this3._doneButtonClickHandler(e);\n        }\n      }, {\n        shortcut: \"cancel\",\n        location: isIOs ? TOOLBAR_ITEM_BEFORE_LOCATION : TOOLBAR_ITEM_AFTER_LOCATION\n      }];\n    }\n  }, {\n    key: \"saveChanges\",\n    value: function (disableButton) {\n      var _this4 = this;\n\n      var deferred = new _deferred.Deferred();\n\n      var validation = this._appointmentForm.validate();\n\n      var state = this.state.appointment;\n\n      var convert = function (obj, dateFieldName) {\n        var date = new Date(_this4.scheduler.fire(\"getField\", dateFieldName, obj));\n\n        var tzDiff = _this4.scheduler._getTimezoneOffsetByOption() * toMs(\"hour\") + _this4.scheduler.fire(\"getClientTimezoneOffset\", date);\n\n        return new Date(date.getTime() + tzDiff);\n      };\n\n      disableButton && this._disableDoneButton();\n      (0, _deferred.when)(validation && validation.complete || validation).done(function (validation) {\n        if (validation && !validation.isValid) {\n          _this4._enableDoneButton();\n\n          deferred.resolve(false);\n          return;\n        }\n\n        var formData = _object2.default.deepExtendArraySafe({}, _this4._getFormData(), true);\n\n        var oldData = _this4.scheduler._editAppointmentData;\n        var recData = _this4.scheduler._updatedRecAppointment;\n\n        if (state.isEmptyText && \"\" === formData.text) {\n          delete formData.text;\n        }\n\n        if (state.isEmptyDescription && \"\" === formData.description) {\n          delete formData.description;\n        }\n\n        if (void 0 === state.data.recurrenceRule && \"\" === formData.recurrenceRule) {\n          delete formData.recurrenceRule;\n        }\n\n        if (oldData) {\n          _this4.scheduler._convertDatesByTimezoneBack(false, formData);\n        }\n\n        if (oldData && !recData) {\n          _this4.scheduler.updateAppointment(oldData, formData);\n        } else {\n          if (recData) {\n            _this4.scheduler.updateAppointment(oldData, recData);\n\n            delete _this4.scheduler._updatedRecAppointment;\n\n            if (\"number\" === typeof _this4.scheduler._getTimezoneOffsetByOption()) {\n              _this4.scheduler.fire(\"setField\", \"startDate\", formData, convert.call(_this4, formData, \"startDate\"));\n\n              _this4.scheduler.fire(\"setField\", \"endDate\", formData, convert.call(_this4, formData, \"endDate\"));\n            }\n          }\n\n          _this4.scheduler.addAppointment(formData);\n        }\n\n        _this4._enableDoneButton();\n\n        _this4.state.lastEditData = formData;\n        deferred.resolve(true);\n      });\n      return deferred.promise();\n    }\n  }, {\n    key: \"_getFormData\",\n    value: function () {\n      var formData = this._appointmentForm.option(\"formData\");\n\n      var startDate = this.scheduler.fire(\"getField\", \"startDate\", formData);\n      var endDate = this.scheduler.fire(\"getField\", \"endDate\", formData);\n      this.scheduler.fire(\"setField\", \"startDate\", formData, startDate);\n      this.scheduler.fire(\"setField\", \"endDate\", formData, endDate);\n      return formData;\n    }\n  }, {\n    key: \"_doneButtonClickHandler\",\n    value: function (e) {\n      e.cancel = true;\n      this.saveEditData();\n    }\n  }, {\n    key: \"saveEditData\",\n    value: function () {\n      var _this5 = this;\n\n      var deferred = new _deferred.Deferred();\n      (0, _deferred.when)(this.saveChanges(true)).done(function () {\n        if (_this5.state.lastEditData) {\n          var startDate = _this5.scheduler.fire(\"getField\", \"startDate\", _this5.state.lastEditData);\n\n          _this5.scheduler._workSpace.updateScrollPosition(startDate);\n\n          _this5.state.lastEditData = null;\n        }\n\n        deferred.resolve();\n      });\n      return deferred.promise();\n    }\n  }, {\n    key: \"_enableDoneButton\",\n    value: function () {\n      var toolbarItems = this._popup.option(\"toolbarItems\");\n\n      toolbarItems[0].options = (0, _extend.extend)(toolbarItems[0].options, {\n        disabled: false\n      });\n\n      this._popup.option(\"toolbarItems\", toolbarItems);\n    }\n  }, {\n    key: \"_disableDoneButton\",\n    value: function () {\n      var toolbarItems = this._popup.option(\"toolbarItems\");\n\n      toolbarItems[0].options = (0, _extend.extend)(toolbarItems[0].options, {\n        disabled: true\n      });\n\n      this._popup.option(\"toolbarItems\", toolbarItems);\n    }\n  }]);\n\n  return AppointmentPopup;\n}();\n\nexports.default = AppointmentPopup;","map":{"version":3,"sources":["C:/Users/Swizzle/Desktop/SE Project/Application/csh/node_modules/devextreme/ui/scheduler/appointmentPopup.js"],"names":["Object","defineProperty","exports","value","default","_renderer","require","_renderer2","_interopRequireDefault","_popup","_popup2","_window","_window2","_uiScheduler","_uiScheduler2","_devices","_devices2","_dom","_dom2","_object","_object2","_date","_date2","_extend","_iterator","_deferred","obj","__esModule","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","_createClass","protoProps","staticProps","prototype","toMs","dateToMilliseconds","WIDGET_CLASS","APPOINTMENT_POPUP_CLASS","concat","APPOINTMENT_POPUP_WIDTH","APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH","TOOLBAR_ITEM_AFTER_LOCATION","TOOLBAR_ITEM_BEFORE_LOCATION","AppointmentPopup","scheduler","_appointmentForm","state","lastEditData","appointment","data","processTimeZone","isEmptyText","isEmptyDescription","showButtons","_this","_createPopup","option","toolbarItems","_getPopupToolbarItems","showCloseButton","initialOption","e","_updateForm","arg","form","appointmentData","cancel","_actions","onAppointmentFormOpening","_processActionResult","canceled","updatePopupFullScreenMode","show","hide","_$popup","$element","remove","popupElement","addClass","appendTo","_createComponent","_createPopupConfig","_this2","height","maxHeight","onHiding","resetValues","focus","contentTemplate","_createPopupContent","defaultOptionsRules","device","current","android","options","showTitle","formElement","_createForm","result","extend","each","_resourcesManager","getResourcesFromItem","name","element","expr","_dataAccessors","resources","prepareAppointmentFormEditors","textExpr","allDayExpr","startDateExpr","endDateExpr","descriptionExpr","recurrenceRuleExpr","startDateTimeZoneExpr","endDateTimeZoneExpr","setResources","concatResources","getEditors","create","bind","_isReadOnly","_createAppointmentFormData","disabled","_editAppointmentData","_editing","allowUpdating","isProcessTimeZone","allDay","fire","startDate","endDate","formData","text","description","recurrenceRule","updateFormData","checkEditorsType","recurrentEditorItem","itemOption","editorOptions","hasWindow","window","getWindow","width","triggerResizeEvent","isVisible","isFullScreen","_isPopupFullScreenNeeded","maxWidth","fullScreen","_this3","isIOs","platform","shortcut","location","onClick","_doneButtonClickHandler","disableButton","_this4","deferred","Deferred","validation","validate","convert","dateFieldName","date","Date","tzDiff","_getTimezoneOffsetByOption","getTime","_disableDoneButton","when","complete","done","isValid","_enableDoneButton","resolve","deepExtendArraySafe","_getFormData","oldData","recData","_updatedRecAppointment","_convertDatesByTimezoneBack","updateAppointment","call","addAppointment","promise","saveEditData","_this5","saveChanges","_workSpace","updateScrollPosition"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/scheduler/appointmentPopup.js)\r\n * Version: 19.2.6\r\n * Build date: Thu Jan 30 2020\r\n *\r\n * Copyright (c) 2012 - 2020 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", {\r\n    value: true\r\n});\r\nexports.default = void 0;\r\nvar _renderer = require(\"../../core/renderer\");\r\nvar _renderer2 = _interopRequireDefault(_renderer);\r\nvar _popup = require(\"../popup\");\r\nvar _popup2 = _interopRequireDefault(_popup);\r\nvar _window = require(\"../../core/utils/window\");\r\nvar _window2 = _interopRequireDefault(_window);\r\nvar _uiScheduler = require(\"./ui.scheduler.appointment_form\");\r\nvar _uiScheduler2 = _interopRequireDefault(_uiScheduler);\r\nvar _devices = require(\"../../core/devices\");\r\nvar _devices2 = _interopRequireDefault(_devices);\r\nvar _dom = require(\"../../core/utils/dom\");\r\nvar _dom2 = _interopRequireDefault(_dom);\r\nvar _object = require(\"../../core/utils/object\");\r\nvar _object2 = _interopRequireDefault(_object);\r\nvar _date = require(\"../../core/utils/date\");\r\nvar _date2 = _interopRequireDefault(_date);\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _classCallCheck(instance, Constructor) {\r\n    if (!(instance instanceof Constructor)) {\r\n        throw new TypeError(\"Cannot call a class as a function\")\r\n    }\r\n}\r\n\r\nfunction _defineProperties(target, props) {\r\n    for (var i = 0; i < props.length; i++) {\r\n        var descriptor = props[i];\r\n        descriptor.enumerable = descriptor.enumerable || false;\r\n        descriptor.configurable = true;\r\n        if (\"value\" in descriptor) {\r\n            descriptor.writable = true\r\n        }\r\n        Object.defineProperty(target, descriptor.key, descriptor)\r\n    }\r\n}\r\n\r\nfunction _createClass(Constructor, protoProps, staticProps) {\r\n    if (protoProps) {\r\n        _defineProperties(Constructor.prototype, protoProps)\r\n    }\r\n    if (staticProps) {\r\n        _defineProperties(Constructor, staticProps)\r\n    }\r\n    return Constructor\r\n}\r\nvar toMs = _date2.default.dateToMilliseconds;\r\nvar WIDGET_CLASS = \"dx-scheduler\";\r\nvar APPOINTMENT_POPUP_CLASS = \"\".concat(WIDGET_CLASS, \"-appointment-popup\");\r\nvar APPOINTMENT_POPUP_WIDTH = 610;\r\nvar APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH = 768;\r\nvar TOOLBAR_ITEM_AFTER_LOCATION = \"after\";\r\nvar TOOLBAR_ITEM_BEFORE_LOCATION = \"before\";\r\nvar AppointmentPopup = function() {\r\n    function AppointmentPopup(scheduler) {\r\n        _classCallCheck(this, AppointmentPopup);\r\n        this.scheduler = scheduler;\r\n        this._popup = null;\r\n        this._appointmentForm = null;\r\n        this.state = {\r\n            lastEditData: null,\r\n            appointment: {\r\n                data: null,\r\n                processTimeZone: false,\r\n                isEmptyText: false,\r\n                isEmptyDescription: false\r\n            }\r\n        }\r\n    }\r\n    _createClass(AppointmentPopup, [{\r\n        key: \"show\",\r\n        value: function(data, showButtons, processTimeZone) {\r\n            var _this = this;\r\n            this.state.appointment = {\r\n                data: data || {},\r\n                processTimeZone: processTimeZone\r\n            };\r\n            if (!this._popup) {\r\n                this._popup = this._createPopup()\r\n            }\r\n            this._popup.option({\r\n                toolbarItems: showButtons ? this._getPopupToolbarItems() : [],\r\n                showCloseButton: showButtons ? this._popup.initialOption(\"showCloseButton\") : true\r\n            });\r\n            this._popup.option(\"onShowing\", function(e) {\r\n                _this._updateForm(data, processTimeZone);\r\n                var arg = {\r\n                    form: _this._appointmentForm,\r\n                    appointmentData: data,\r\n                    cancel: false\r\n                };\r\n                _this.scheduler._actions.onAppointmentFormOpening(arg);\r\n                _this.scheduler._processActionResult(arg, function(canceled) {\r\n                    if (canceled) {\r\n                        e.cancel = true\r\n                    } else {\r\n                        _this.updatePopupFullScreenMode()\r\n                    }\r\n                })\r\n            });\r\n            this._popup.show()\r\n        }\r\n    }, {\r\n        key: \"hide\",\r\n        value: function() {\r\n            this._popup.hide()\r\n        }\r\n    }, {\r\n        key: \"isVisible\",\r\n        value: function() {\r\n            return this._popup ? this._popup.option(\"visible\") : false\r\n        }\r\n    }, {\r\n        key: \"getPopup\",\r\n        value: function() {\r\n            return this._popup\r\n        }\r\n    }, {\r\n        key: \"dispose\",\r\n        value: function() {\r\n            if (this._$popup) {\r\n                this._popup.$element().remove();\r\n                this._$popup = null\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_createPopup\",\r\n        value: function() {\r\n            var popupElement = (0, _renderer2.default)(\"<div>\").addClass(APPOINTMENT_POPUP_CLASS).appendTo(this.scheduler.$element());\r\n            return this.scheduler._createComponent(popupElement, _popup2.default, this._createPopupConfig())\r\n        }\r\n    }, {\r\n        key: \"_createPopupConfig\",\r\n        value: function() {\r\n            var _this2 = this;\r\n            return {\r\n                height: \"auto\",\r\n                maxHeight: \"100%\",\r\n                onHiding: function() {\r\n                    _this2._appointmentForm.resetValues();\r\n                    _this2.scheduler.focus()\r\n                },\r\n                contentTemplate: function() {\r\n                    return _this2._createPopupContent()\r\n                },\r\n                defaultOptionsRules: [{\r\n                    device: function() {\r\n                        return _devices2.default.current().android\r\n                    },\r\n                    options: {\r\n                        showTitle: false\r\n                    }\r\n                }]\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_createPopupContent\",\r\n        value: function() {\r\n            var formElement = (0, _renderer2.default)(\"<div>\");\r\n            this._appointmentForm = this._createForm(formElement);\r\n            return formElement\r\n        }\r\n    }, {\r\n        key: \"_createAppointmentFormData\",\r\n        value: function(appointmentData) {\r\n            var result = (0, _extend.extend)(true, {}, appointmentData);\r\n            (0, _iterator.each)(this.scheduler._resourcesManager.getResourcesFromItem(result, true) || {}, function(name, value) {\r\n                return result[name] = value\r\n            });\r\n            return result\r\n        }\r\n    }, {\r\n        key: \"_createForm\",\r\n        value: function(element) {\r\n            var expr = this.scheduler._dataAccessors.expr;\r\n            var resources = this.scheduler.option(\"resources\");\r\n            _uiScheduler2.default.prepareAppointmentFormEditors({\r\n                textExpr: expr.textExpr,\r\n                allDayExpr: expr.allDayExpr,\r\n                startDateExpr: expr.startDateExpr,\r\n                endDateExpr: expr.endDateExpr,\r\n                descriptionExpr: expr.descriptionExpr,\r\n                recurrenceRuleExpr: expr.recurrenceRuleExpr,\r\n                startDateTimeZoneExpr: expr.startDateTimeZoneExpr,\r\n                endDateTimeZoneExpr: expr.endDateTimeZoneExpr\r\n            }, this.scheduler);\r\n            if (resources && resources.length) {\r\n                this.scheduler._resourcesManager.setResources(this.scheduler.option(\"resources\"));\r\n                _uiScheduler2.default.concatResources(this.scheduler._resourcesManager.getEditors())\r\n            }\r\n            return _uiScheduler2.default.create(this.scheduler._createComponent.bind(this.scheduler), element, this._isReadOnly(this.state.appointment.data), this._createAppointmentFormData(this.state.appointment.data))\r\n        }\r\n    }, {\r\n        key: \"_isReadOnly\",\r\n        value: function(data) {\r\n            if (data && data.disabled) {\r\n                return true\r\n            }\r\n            return this.scheduler._editAppointmentData ? !this.scheduler._editing.allowUpdating : false\r\n        }\r\n    }, {\r\n        key: \"_updateForm\",\r\n        value: function(appointmentData, isProcessTimeZone) {\r\n            var allDay = this.scheduler.fire(\"getField\", \"allDay\", appointmentData);\r\n            var startDate = this.scheduler.fire(\"getField\", \"startDate\", appointmentData);\r\n            var endDate = this.scheduler.fire(\"getField\", \"endDate\", appointmentData);\r\n            var formData = this._createAppointmentFormData(appointmentData);\r\n            this.state.appointment.isEmptyText = void 0 === appointmentData || void 0 === appointmentData.text;\r\n            this.state.appointment.isEmptyDescription = void 0 === appointmentData || void 0 === appointmentData.description;\r\n            if (this.state.appointment.isEmptyText) {\r\n                formData.text = \"\"\r\n            }\r\n            if (this.state.appointment.isEmptyDescription) {\r\n                formData.description = \"\"\r\n            }\r\n            if (isProcessTimeZone) {\r\n                startDate = this.scheduler.fire(\"convertDateByTimezone\", startDate);\r\n                endDate = this.scheduler.fire(\"convertDateByTimezone\", endDate);\r\n                this.scheduler.fire(\"setField\", \"startDate\", formData, startDate);\r\n                this.scheduler.fire(\"setField\", \"endDate\", formData, endDate)\r\n            }\r\n            var startDateExpr = this.scheduler._dataAccessors.expr.startDateExpr;\r\n            var endDateExpr = this.scheduler._dataAccessors.expr.endDateExpr;\r\n            formData.recurrenceRule = formData.recurrenceRule || \"\";\r\n            _uiScheduler2.default.updateFormData(this._appointmentForm, formData);\r\n            this._appointmentForm.option(\"readOnly\", this._isReadOnly(this.state.appointment.data));\r\n            _uiScheduler2.default.checkEditorsType(this._appointmentForm, startDateExpr, endDateExpr, allDay);\r\n            var recurrenceRuleExpr = this.scheduler._dataAccessors.expr.recurrenceRuleExpr;\r\n            var recurrentEditorItem = recurrenceRuleExpr ? this._appointmentForm.itemOption(recurrenceRuleExpr) : null;\r\n            if (recurrentEditorItem) {\r\n                var options = recurrentEditorItem.editorOptions || {};\r\n                options.startDate = startDate;\r\n                this._appointmentForm.itemOption(recurrenceRuleExpr, \"editorOptions\", options)\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_isPopupFullScreenNeeded\",\r\n        value: function() {\r\n            if (_window2.default.hasWindow()) {\r\n                var window = _window2.default.getWindow();\r\n                return (0, _renderer2.default)(window).width() < APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH\r\n            }\r\n            return false\r\n        }\r\n    }, {\r\n        key: \"triggerResize\",\r\n        value: function() {\r\n            this._popup && _dom2.default.triggerResizeEvent(this._popup.$element())\r\n        }\r\n    }, {\r\n        key: \"updatePopupFullScreenMode\",\r\n        value: function() {\r\n            if (this.isVisible()) {\r\n                var isFullScreen = this._isPopupFullScreenNeeded();\r\n                this._popup.option({\r\n                    maxWidth: isFullScreen ? \"100%\" : APPOINTMENT_POPUP_WIDTH,\r\n                    fullScreen: isFullScreen\r\n                })\r\n            }\r\n        }\r\n    }, {\r\n        key: \"_getPopupToolbarItems\",\r\n        value: function() {\r\n            var _this3 = this;\r\n            var isIOs = \"ios\" === _devices2.default.current().platform;\r\n            return [{\r\n                shortcut: \"done\",\r\n                location: TOOLBAR_ITEM_AFTER_LOCATION,\r\n                onClick: function(e) {\r\n                    return _this3._doneButtonClickHandler(e)\r\n                }\r\n            }, {\r\n                shortcut: \"cancel\",\r\n                location: isIOs ? TOOLBAR_ITEM_BEFORE_LOCATION : TOOLBAR_ITEM_AFTER_LOCATION\r\n            }]\r\n        }\r\n    }, {\r\n        key: \"saveChanges\",\r\n        value: function(disableButton) {\r\n            var _this4 = this;\r\n            var deferred = new _deferred.Deferred;\r\n            var validation = this._appointmentForm.validate();\r\n            var state = this.state.appointment;\r\n            var convert = function(obj, dateFieldName) {\r\n                var date = new Date(_this4.scheduler.fire(\"getField\", dateFieldName, obj));\r\n                var tzDiff = _this4.scheduler._getTimezoneOffsetByOption() * toMs(\"hour\") + _this4.scheduler.fire(\"getClientTimezoneOffset\", date);\r\n                return new Date(date.getTime() + tzDiff)\r\n            };\r\n            disableButton && this._disableDoneButton();\r\n            (0, _deferred.when)(validation && validation.complete || validation).done(function(validation) {\r\n                if (validation && !validation.isValid) {\r\n                    _this4._enableDoneButton();\r\n                    deferred.resolve(false);\r\n                    return\r\n                }\r\n                var formData = _object2.default.deepExtendArraySafe({}, _this4._getFormData(), true);\r\n                var oldData = _this4.scheduler._editAppointmentData;\r\n                var recData = _this4.scheduler._updatedRecAppointment;\r\n                if (state.isEmptyText && \"\" === formData.text) {\r\n                    delete formData.text\r\n                }\r\n                if (state.isEmptyDescription && \"\" === formData.description) {\r\n                    delete formData.description\r\n                }\r\n                if (void 0 === state.data.recurrenceRule && \"\" === formData.recurrenceRule) {\r\n                    delete formData.recurrenceRule\r\n                }\r\n                if (oldData) {\r\n                    _this4.scheduler._convertDatesByTimezoneBack(false, formData)\r\n                }\r\n                if (oldData && !recData) {\r\n                    _this4.scheduler.updateAppointment(oldData, formData)\r\n                } else {\r\n                    if (recData) {\r\n                        _this4.scheduler.updateAppointment(oldData, recData);\r\n                        delete _this4.scheduler._updatedRecAppointment;\r\n                        if (\"number\" === typeof _this4.scheduler._getTimezoneOffsetByOption()) {\r\n                            _this4.scheduler.fire(\"setField\", \"startDate\", formData, convert.call(_this4, formData, \"startDate\"));\r\n                            _this4.scheduler.fire(\"setField\", \"endDate\", formData, convert.call(_this4, formData, \"endDate\"))\r\n                        }\r\n                    }\r\n                    _this4.scheduler.addAppointment(formData)\r\n                }\r\n                _this4._enableDoneButton();\r\n                _this4.state.lastEditData = formData;\r\n                deferred.resolve(true)\r\n            });\r\n            return deferred.promise()\r\n        }\r\n    }, {\r\n        key: \"_getFormData\",\r\n        value: function() {\r\n            var formData = this._appointmentForm.option(\"formData\");\r\n            var startDate = this.scheduler.fire(\"getField\", \"startDate\", formData);\r\n            var endDate = this.scheduler.fire(\"getField\", \"endDate\", formData);\r\n            this.scheduler.fire(\"setField\", \"startDate\", formData, startDate);\r\n            this.scheduler.fire(\"setField\", \"endDate\", formData, endDate);\r\n            return formData\r\n        }\r\n    }, {\r\n        key: \"_doneButtonClickHandler\",\r\n        value: function(e) {\r\n            e.cancel = true;\r\n            this.saveEditData()\r\n        }\r\n    }, {\r\n        key: \"saveEditData\",\r\n        value: function() {\r\n            var _this5 = this;\r\n            var deferred = new _deferred.Deferred;\r\n            (0, _deferred.when)(this.saveChanges(true)).done(function() {\r\n                if (_this5.state.lastEditData) {\r\n                    var startDate = _this5.scheduler.fire(\"getField\", \"startDate\", _this5.state.lastEditData);\r\n                    _this5.scheduler._workSpace.updateScrollPosition(startDate);\r\n                    _this5.state.lastEditData = null\r\n                }\r\n                deferred.resolve()\r\n            });\r\n            return deferred.promise()\r\n        }\r\n    }, {\r\n        key: \"_enableDoneButton\",\r\n        value: function() {\r\n            var toolbarItems = this._popup.option(\"toolbarItems\");\r\n            toolbarItems[0].options = (0, _extend.extend)(toolbarItems[0].options, {\r\n                disabled: false\r\n            });\r\n            this._popup.option(\"toolbarItems\", toolbarItems)\r\n        }\r\n    }, {\r\n        key: \"_disableDoneButton\",\r\n        value: function() {\r\n            var toolbarItems = this._popup.option(\"toolbarItems\");\r\n            toolbarItems[0].options = (0, _extend.extend)(toolbarItems[0].options, {\r\n                disabled: true\r\n            });\r\n            this._popup.option(\"toolbarItems\", toolbarItems)\r\n        }\r\n    }]);\r\n    return AppointmentPopup\r\n}();\r\nexports.default = AppointmentPopup;\r\n"]},"metadata":{},"sourceType":"script"}